---
// Styles
import '../styles/global.css';

import Layout from '../layouts/Layout.astro';
import Title from '../components/Title.astro'
import WindowButton from '../components/WindowButton.astro';
import LinkedInBadge from '../components/LinkedIn-Badge.astro';
import AccordionButton from '../components/AccordionButton.astro';
import LinkButton from '../components/LinkButton.astro';
import Sidebar from '../components/Sidebar.astro'
import Jobs from '../components/Jobs.astro';
import Project from '../components/Project.astro';
import Education from '../components/Education.astro';
import Skills from '../components/Skills.astro';

// Icons
import ProjectIcon from '../assets/icons/Project-Icon.astro';
import AboutIcon from '../assets/icons/About-Icon.astro';
import EducationIcon from '../assets/icons/Education-Icon.astro';
import SkillIcon from '../assets/icons/Skill-Icon.astro';
import JobsIcon from '../assets/icons/Jobs-Icon.astro';
import LinkedInIcon from '../assets/icons/LinkedIn-Icon.astro';
import GitHubIcon from '../assets/icons/GitHub-Icon.astro';
import InstagramIcon from '../assets/icons/Instagram-Icon.astro';
import PhoneIcon from '../assets/icons/Phone-Icon.astro';
import EmailIcon from '../assets/icons/Email-Icon.astro';

// URLs
const linkedInUrl = 'https://www.linkedin.com/in/alvarogmez/';
const gitHubUrl = 'https://github.com/Alvaro-Gmez';
const instagramUrl = 'https://www.instagram.com/aalvarogoomeez/';

// Image
import { Image } from 'astro:assets';
import logotipo from '/public/assets/images/logotipo.webp';
import avatar from '/public/assets/images/alvaro_avatar.webp';
---

<Layout 
  title="Álvaro Gómez - Full Stack Developer"
  description="Contrata a Álvaro Gómez, un desarrollador Full Stack con experiencia en tecnologías modernas como Angular, Spring Boot y más. Crea aplicaciones web rápidas y eficientes con un enfoque en la experiencia del usuario."
  author="Álvaro Gómez"
>
  <section class="flex backdrop-blur-[15px]">
    {/* Sidebar */}
    <aside class="w-[12dvw] h-[91dvh] bg-[var(--main-bg)] border-r border-[var(--border-color)] rounded-s-[25px] ">
      <div class="flex justify-start items-center group h-[6vh] pl-6 border-b border-[--border-color]">
        <WindowButton class="bg-red-500" href="assets/icons/close-icon.png" alt="Close"/>
        <WindowButton class="bg-yellow-500" href="assets/icons/subtract-icon.png" alt="Minimize"/>
        <WindowButton class="bg-green-500" href="assets/icons/full-screen-icon.png" alt="Full screen"/>
      </div>
      <div class="px-5">
        <div class="flex flex-col gap-1.5 my-6">
          <AccordionButton title="Categorias" />
          <LinkButton class="tooltip-container" href="#about" title="Sobre mí">
            <AboutIcon/>
            <span class="hidden 2xl:inline">Sobre mí</span>
          </LinkButton>
          <!-- <LinkButton class="tooltip-container" href="#jobs" title="Experiencia">
            <JobsIcon/><span class="hidden 2xl:inline">Experiencia</span>
          </LinkButton> -->
          <LinkButton class="tooltip-container" href="#projects" title="Proyectos">
            <ProjectIcon/>
            <span class="hidden 2xl:inline">Proyectos</span>
          </LinkButton>
          <LinkButton class="tooltip-container" href="#education" title="Educación">
            <EducationIcon/>
            <span class="hidden 2xl:inline">Educación</span>
          </LinkButton>
          <LinkButton class="tooltip-container" href="#skills" title="Habilidades">
            <SkillIcon/>
            <span class="hidden 2xl:inline">Habilidades</span>
          </LinkButton>
        </div>
        <div class="flex flex-col gap-1.5 my-6">
          <AccordionButton title="Contactos" />
          <LinkButton class="tooltip-container" href={linkedInUrl} target="_blank" rel="noopener" title="LinkedIn">
            <LinkedInIcon/>
            <span class="hidden 2xl:inline">LinkedIn</span>
          </LinkButton>
          <LinkButton class="tooltip-container" href={gitHubUrl} target="_blank" rel="noopener" title="GitHub">
            <GitHubIcon/>
            <span class="hidden 2xl:inline">GitHub</span>
          </LinkButton>
          <LinkButton class="tooltip-container" href={instagramUrl} target="_blank" rel="noopener" title="Instagram">
            <InstagramIcon/>
            <span class="hidden 2xl:inline">Instagram</span>
          </LinkButton>
          <LinkButton class="copy-btn tooltip-container" data-copy="+34672775698" aria-label="Copiar telefono" title="Teléfono">
            <PhoneIcon/>
            <span class="hidden 2xl:inline">Teléfono</span>
            <span class="absolute p-2 text-center text-sm text-white rounded-lg 
                          bg-[var(--main-bg)] backdrop-blur-lg
                          transition-all duration-500 transform translate-y-20 2xl:translate-y-9
                          opacity-0 pointer-events-none copy-tooltip"
            >
              ¡Teléfono copiado!✅
            </span>
          </LinkButton>
          <LinkButton class="copy-btn tooltip-container" data-copy="gomezdelgadoalvaro04@gmail.com" aria-label="Copiar correo" title="Correo">
            <EmailIcon/>
            <span class="hidden 2xl:inline">Correo</span>
            <span class="absolute p-2 text-center text-sm text-white whitespace-nowrap rounded-lg 
                          bg-[var(--main-bg)] backdrop-blur-lg border border-[--border-color]
                          transition-all duration-500 transform translate-y-20 2xl:translate-y-9
                          opacity-0 pointer-events-none 
                          copy-tooltip"
            >
              ¡Correo copiado!✅
            </span>
          </LinkButton>
        </div>
      </div>
    </aside>
    <section>
      
      {/* Navbar */}
      <nav class="flex flex-col sm:flex-row justify-center sm:justify-end items-center gap-4 
                  w-[80dvw] md:w-[60dvw] h-[6dvh] px-4 bg-[var(--main-bg)] 
                  border-b border-[var(--border-color)] rounded-tr-[25px]"
      >
        <div class="flex gap-4 ">
          <a 
            href="https://www.linkedin.com/in/alvarogmez/" 
            target="_blank" 
            rel="noopener" 
            class="flex items-center transition md:justify-center md:hover:scale-105"
          >
            <LinkedInBadge />
          </a>
          <Image 
            src={logotipo} 
            alt="Foto de perfil del porfolio" 
            loading="eager" 
            class="size-8 lg:size-9 xl:size-10 border border-[--border-color] rounded-full"
          />
        </div>
      </nav>
      
      {/* Main Content */}
      <main class="w-[80dvw] md:w-[60dvw] h-[85dvh] p-6 overflow-y-auto scroll-smooth bg-[var(--main-bg)] rounded-br-[25px] text-center sm:text-left">
          
          {/* About me */}
          <article id="about" class="flex rounded-3xl bg-animated-gradient">
            <div class="flex flex-col justify-between w-fit m-6">
              
              <h1 class="xs:text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold">
                Hola, soy Álvaro Gómez
              </h1>
              <h3 class="xs:text-sm sm:text-base lg:text-lg xl:text-xl font-semibold text-white/50">
                Desarrollador Full Stack
              </h3>

              <div class="h-full my-4 text-xs sm:text-sm xl:text-base text-pretty leading-7">
                <p class="mb-3">
                  Me gusta dar vida a aplicaciones web que sean modernas, rápidas y agradables de usar. Trabajo tanto en el frontend como en el backend, con especial cariño por <span class="font-bold italic">Angular</span> y <span class="font-bold italic">Spring Boot</span>, herramientas que pude poner en práctica durante mi formación dual y mis primeras experiencias en <span class="font-bold">Vitaly</span>.
                </p>
                <p class="mb-3">
                  Me considero una persona disciplinada y proactiva, que disfruta aprendiendo cada día y no se echa para atrás ante nuevos retos. Para mí, cada proyecto es una oportunidad de aprender, adaptarme y aportar valor real.
                </p>
              </div>
              <a 
                href="alvaro_gomez_CV.pdf" 
                download="Álvaro_Gómez_CV.pdf" 
                class="sm:w-fit rounded-lg px-4 py-2 bg-white/60 text-black
                        transition hover:bg-white/90 hover:scale-105"
              >
                Descargar CV
              </a>
            </div>

            {/* Avatar Image */}
            <div class="hidden md:flex items-center justify-center w-1/3 ">
              <Image 
                src={avatar} 
                alt="Avatar de Álvaro Gómez" 
                loading="eager" 
                class="w-fit animate-float" 
              />
            </div>
          </article>
          
          {/* Jobs */}

          {/* Projects */}
          <article id="projects">
            <Title title="Mis Proyectos"/>
            <div class="grid grid-cols-1 gap-4 lg:grid-cols-2 md:grid-cols-1">
              <Project />
            </div>
          </article>

          {/* Education */}
          <article id="education">
            <Title title="Mi Educación"/>
            <div class="p-4 bg-[var(--main-bg)] rounded-2xl">
              <Education />
            </div>
          </article>

          {/* Skills */}
          <article id="skills">
            <Title title="Mis Habilidades"/>
            <Skills />
          </article>
      </main>
    </section>
  </section>

  {/* Copy to clipboard */}
  <script is:inline>
    // Espera a cargar el DOM
    document.addEventListener("DOMContentLoaded", () => {
      // Recoger los botones de copia
      const buttons = document.querySelectorAll(".copy-btn");

      // Recorre cada boton y añade el evento de click
      buttons.forEach(btn => {
        btn.addEventListener("click", async (e) => {
          e.preventDefault();

          // Comprueba que el click viene del boton
          const target = e.target.closest(".copy-btn");
          if (!target) return;

          // Recoge el valor a copiar
          const value = btn.getAttribute("data-copy");
          if (!value) return;

          try {
            await navigator.clipboard.writeText(value);

            const tooltip = btn.querySelector(".copy-tooltip");
            if(tooltip) {
              tooltip.classList.remove("opacity-0", "pointer-events-none");
              tooltip.classList.add("opacity-100",);
              
              setTimeout(() => {
                tooltip.classList.add("opacity-0", "pointer-events-none",);
                tooltip.classList.remove("opacity-100", );
              }, 1200);
            }
          } catch (err) {
            console.error("Error al copiar", err);
          }
        });
      });
    });
  </script>

  {/* Section tracker */}
  <script is:inline>
    // Espera a cargar el DOM
    document.addEventListener("DOMContentLoaded", () => {
      // Se cargan los articles del main que tienen id y los enlaces del aside
      const sections = document.querySelectorAll("main article[id]");
      const navLinks = document.querySelectorAll("aside a[href^='#']");

      // Comprueba que secciones entra y salen del viewport
      const observer = new IntersectionObserver((entries) => {
        //Itera las entradas del observer
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            // Quita la clase de todas los botones
            navLinks.forEach(link => link.classList.remove("active"));
            // Carga la seccion activa 
            const id = entry.target.getAttribute("id");
            const active = document.querySelector(`aside a[href="#${id}"]`);
            // Activa el boton de la seccion
            if (active) active.classList.add("active");
          }
        });
      }, {
        // El boton se activa si en el viewport esta el 60% del contenido 
        threshold: 0.6 
      });

      sections.forEach(section => observer.observe(section));
    });
  </script>
</Layout>
